# AI Agent 可视化编排工具 - 完整项目拆建与任务拆分

> 基于所有 Design 文档整合
> 版本: v1.0
> 日期: 2026年1月

---

## 目录

1. [项目概述](#1-项目概述)
2. [架构总览](#2-架构总览)
3. [模块拆分](#3-模块拆分)
4. [任务拆分详解](#4-任务拆分详解)
5. [开发里程碑](#5-开发里程碑)
6. [依赖关系图](#6-依赖关系图)
7. [团队分工建议](#7-团队分工建议)

---

## 1. 项目概述

### 1.1 项目定位

**AI Agent 可视化编排工具** 是一个融合 **agent-wechat 去中心化蜂群设计** 和 **传统可视化编排** 的混合架构平台。

### 1.2 核心特性

| 特性 | 描述 |
|------|------|
| 可视化编排 | 拖拽式画布、节点连线、属性配置 |
| 去中心化运行时 | Agent自运行、消息驱动、人机等价 |
| IM消息总线 | Group/Message机制、P2P=2人群 |
| 流式执行 | 实时状态推送、思考过程可视化 |
| 检查点恢复 | 故障恢复、时间旅行调试 |

### 1.3 技术栈总览

| 层级 | 技术选型 |
|------|---------|
| 运行时 | Bun |
| 后端框架 | Next.js 16 (Route Handlers) |
| 数据库 | PostgreSQL 16 + Drizzle ORM |
| 缓存/消息 | Redis 7 + Redis Streams |
| 前端框架 | React 19 + Next.js |
| UI组件 | Tailwind CSS 4 + shadcn/ui |
| 画布引擎 | ReactFlow 12 |
| 状态管理 | Zustand + Immer |
| 工具协议 | MCP (Model Context Protocol) |

---

## 2. 架构总览

### 2.1 系统分层

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              系统架构总览                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                        表现层 (Presentation)                            │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │ │
│  │  │   Web UI     │  │   VS Code    │  │   Mobile     │                 │ │
│  │  │  (React)     │  │   插件       │  │   App        │                 │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │ │
│  └──────────────────────────────────┬─────────────────────────────────────┘ │
│                                     │                                       │
│  ┌──────────────────────────────────┼─────────────────────────────────────┐ │
│  │                        编排层 (Orchestration)         ★ 中心化        │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │ │
│  │  │  画布编辑器   │  │  工作流引擎   │  │  执行追踪器   │                 │ │
│  │  │ (ReactFlow)  │  │  (DAG执行)   │  │ (实时状态)   │                 │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │ │
│  └──────────────────────────────────┬─────────────────────────────────────┘ │
│                                     │                                       │
│  ┌──────────────────────────────────┼─────────────────────────────────────┐ │
│  │                        运行时层 (Runtime)              ★ 去中心化      │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │ │
│  │  │  Agent管理器  │  │  消息总线    │  │  状态机      │                 │ │
│  │  │(生命周期)   │  │(Group/Msg)  │  │(上下文)     │                 │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │ │
│  │  │  Agent运行时  │  │  工具市场    │  │  检查点      │                 │ │
│  │  │(while循环)  │  │(MCP协议)    │  │(故障恢复)   │                 │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │ │
│  └──────────────────────────────────┬─────────────────────────────────────┘ │
│                                     │                                       │
│  ┌──────────────────────────────────┼─────────────────────────────────────┐ │
│  │                        数据层 (Data)                                   │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │ │
│  │  │  PostgreSQL  │  │    Redis     │  │    MinIO     │                 │ │
│  │  │ (元数据)     │  │ (缓存/消息)  │  │(对象存储)   │                 │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                        集成层 (Integration)                             │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │ │
│  │  │ LLM Provider │  │  MCP Tools   │  │  External    │                 │ │
│  │  │(OpenAI/etc) │  │(动态加载)   │  │    APIs      │                 │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 核心设计理念

**编排层中心化 + 运行时去中心化**

- **编排层**：可视化、可控、可追踪、支持复杂流程
- **运行时**：自组织、动态伸缩、人机协作自然

---

## 3. 模块拆分

### 3.1 一级模块划分

```
ai-agent-orchestration-platform/
├── 📁 apps/
│   ├── 📁 web/                          # Next.js 全栈应用
│   │   ├── 📁 app/                      # App Router
│   │   │   ├── 📁 (auth)/               # 认证路由组
│   │   │   ├── 📁 workspace/            # 工作空间
│   │   │   ├── 📁 workflow/             # 工作流管理
│   │   │   ├── 📁 agent/                # Agent管理
│   │   │   ├── 📁 execution/            # 执行监控
│   │   │   └── 📁 api/                  # API Routes
│   │   ├── 📁 components/               # React组件
│   │   ├── 📁 lib/                      # 工具函数
│   │   └── 📁 hooks/                    # 自定义Hooks
│   │
│   └── 📁 docs/                         # 文档站点
│
├── 📁 packages/
│   ├── 📁 core/                         # 核心共享代码
│   │   ├── 📁 schema/                   # 数据库Schema (Drizzle)
│   │   ├── 📁 types/                    # TypeScript类型定义
│   │   └── 📁 constants/                # 常量定义
│   │
│   ├── 📁 orchestration/                # 编排引擎 (中心化)
│   │   ├── 📁 canvas/                   # 画布核心
│   │   ├── 📁 workflow/                 # 工作流引擎
│   │   └── 📁 execution/                # 执行追踪
│   │
│   ├── 📁 runtime/                      # 运行时引擎 (去中心化)
│   │   ├── 📁 agent/                    # Agent运行时
│   │   ├── 📁 message/                  # 消息总线
│   │   └── 📁 checkpoint/               # 检查点管理
│   │
│   ├── 📁 ui/                           # UI组件库
│   │   ├── 📁 components/               # shadcn/ui组件
│   │   └── 📁 flow/                     # ReactFlow自定义节点
│   │
│   ├── 📁 mcp/                          # MCP协议实现
│   │   ├── 📁 client/                   # MCP客户端
│   │   └── 📁 registry/                 # 工具注册表
│   │
│   └── 📁 config/                       # 共享配置
│       ├── eslint/                      # ESLint配置
│       ├── typescript/                  # TS配置
│       └── tailwind/                    # Tailwind配置
│
├── 📁 infrastructure/
│   ├── 📁 docker/                       # Docker配置
│   ├── 📁 k8s/                          # Kubernetes配置
│   ├── 📁 terraform/                    # IaC配置
│   └── 📁 scripts/                      # 运维脚本
│
├── 📁 docs/                             # 项目文档
│   ├── 📁 design/                       # 设计文档
│   ├── 📁 api/                          # API文档
│   └── 📁 deployment/                   # 部署文档
│
└── 📁 tests/
    ├── 📁 unit/                         # 单元测试
    ├── 📁 integration/                  # 集成测试
    └── 📁 e2e/                          # E2E测试
```

### 3.2 模块职责矩阵

| 模块 | 职责 | 技术栈 | 依赖 |
|------|------|--------|------|
| `apps/web` | 全栈Web应用 | Next.js 16, React 19 | core, orchestration, runtime, ui |
| `packages/core` | 共享类型和Schema | TypeScript, Drizzle | 无 |
| `packages/orchestration` | 编排引擎 | TypeScript | core |
| `packages/runtime` | 运行时引擎 | TypeScript | core, message |
| `packages/ui` | UI组件库 | React, Tailwind | core |
| `packages/mcp` | MCP协议 | TypeScript | core |

---

## 4. 任务拆分详解

### Phase 1: 基础架构 (第1-3周)

#### 1.1 项目脚手架
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P1-T1 | 初始化Monorepo | 配置Turborepo + pnpm workspace | 4h | 待分配 | 无 |
| P1-T2 | 配置TypeScript | 共享TS配置、严格模式启用 | 2h | 待分配 | P1-T1 |
| P1-T3 | 配置ESLint + Prettier | 代码规范统一 | 2h | 待分配 | P1-T1 |
| P1-T4 | 配置Tailwind CSS | 设计系统基础 | 2h | 待分配 | P1-T1 |
| P1-T5 | 初始化Next.js 16 | App Router、Route Handlers | 4h | 待分配 | P1-T1 |
| P1-T6 | 配置shadcn/ui | 基础组件库 | 2h | 待分配 | P1-T5 |

#### 1.2 数据库架构
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P1-T7 | 配置Drizzle ORM | 类型安全数据库访问 | 4h | 待分配 | 无 |
| P1-T8 | 设计数据库Schema | workspaces, agents, workflows等 | 8h | 待分配 | P1-T7 |
| P1-T9 | 创建基础表 | PostgreSQL表创建 | 4h | 待分配 | P1-T8 |
| P1-T10 | 配置Redis | 缓存和消息队列 | 2h | 待分配 | 无 |
| P1-T11 | 数据库迁移脚本 | Drizzle Kit配置 | 2h | 待分配 | P1-T9 |

#### 1.3 核心类型定义
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P1-T12 | Agent类型定义 | AgentDefinition, AgentInstance | 4h | 待分配 | P1-T8 |
| P1-T13 | 工作流类型定义 | WorkflowDefinition, Node, Edge | 4h | 待分配 | P1-T12 |
| P1-T14 | 执行类型定义 | ExecutionInstance, Checkpoint | 4h | 待分配 | P1-T13 |
| P1-T15 | 消息类型定义 | Group, Message, IM系统 | 4h | 待分配 | P1-T14 |

**Phase 1 交付物：**
- [ ] 可运行的项目脚手架
- [ ] 数据库Schema和迁移脚本
- [ ] 完整的TypeScript类型定义
- [ ] Docker Compose开发环境

---

### Phase 2: Agent运行时 (第4-7周)

#### 2.1 Agent运行时核心
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P2-T1 | AgentRuntime类 | while(true)主循环实现 | 8h | 待分配 | P1-T12 |
| P2-T2 | 消息获取机制 | getAllUnread, 阻塞等待 | 6h | 待分配 | P2-T1 |
| P2-T3 | 上下文管理 | llmHistory, 状态持久化 | 6h | 待分配 | P2-T1 |
| P2-T4 | LLM流式调用 | 流式输出、tool_calls处理 | 8h | 待分配 | P2-T3 |
| P2-T5 | 工具执行 | MCP工具调用、结果处理 | 6h | 待分配 | P2-T4 |
| P2-T6 | 错误处理 | 异常捕获、状态恢复 | 4h | 待分配 | P2-T1 |

#### 2.2 Agent管理器
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P2-T7 | AgentManager类 | 生命周期管理 | 6h | 待分配 | P2-T1 |
| P2-T8 | Agent工厂 | 动态创建Agent实例 | 4h | 待分配 | P2-T7 |
| P2-T9 | 父子Agent | 动态创建子Agent | 6h | 待分配 | P2-T8 |
| P2-T10 | 状态机 | CREATED→RUNNING→TERMINATED | 6h | 待分配 | P2-T7 |
| P2-T11 | 并发控制 | Agent执行池、资源限制 | 6h | 待分配 | P2-T10 |

#### 2.3 消息总线 (IM系统)
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P2-T12 | MessageService | 消息发送、接收、持久化 | 8h | 待分配 | P1-T15 |
| P2-T13 | Group管理 | P2P/Group创建、成员管理 | 6h | 待分配 | P2-T12 |
| P2-T14 | Redis Streams | 消息流、Pub/Sub | 6h | 待分配 | P2-T12 |
| P2-T15 | 唤醒机制 | Redis Pub/Sub唤醒Agent | 4h | 待分配 | P2-T14 |
| P2-T16 | 未读消息 | lastReadMessageId追踪 | 4h | 待分配 | P2-T12 |

#### 2.4 MCP工具集成
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P2-T17 | MCP Client | MCP SDK集成 | 6h | 待分配 | 无 |
| P2-T18 | 工具注册表 | 动态加载MCP工具 | 6h | 待分配 | P2-T17 |
| P2-T19 | 工具执行器 | 工具调用、结果返回 | 4h | 待分配 | P2-T18 |

**Phase 2 交付物：**
- [ ] Agent自运行机制
- [ ] 消息总线系统
- [ ] MCP工具集成
- [ ] 基础API接口

---

### Phase 3: 可视化编辑器 (第8-11周)

#### 3.1 ReactFlow画布
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P3-T1 | ReactFlow集成 | 基础画布配置 | 4h | 待分配 | P1-T5 |
| P3-T2 | 自定义节点 | AgentNode, ToolNode, ConditionNode | 8h | 待分配 | P3-T1 |
| P3-T3 | 自定义连线 | 连线样式、动画、标签 | 4h | 待分配 | P3-T1 |
| P3-T4 | 画布交互 | 拖拽、缩放、平移、框选 | 4h | 待分配 | P3-T1 |
| P3-T5 | 小地图/控件 | MiniMap, Controls, Background | 2h | 待分配 | P3-T1 |

#### 3.2 节点系统
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P3-T6 | 节点注册表 | NodeRegistry, 动态注册 | 6h | 待分配 | P3-T2 |
| P3-T7 | 节点类型定义 | 内置节点类型配置 | 6h | 待分配 | P3-T6 |
| P3-T8 | 端口系统 | 输入/输出端口定义 | 4h | 待分配 | P3-T7 |
| P3-T9 | 节点分类 | Category分组显示 | 2h | 待分配 | P3-T7 |
| P3-T10 | 节点搜索 | 节点库搜索功能 | 2h | 待分配 | P3-T9 |

#### 3.3 属性面板
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P3-T11 | 动态表单 | 基于schema渲染表单 | 8h | 待分配 | P3-T7 |
| P3-T12 | JSON Schema | schema定义和转换 | 4h | 待分配 | P3-T11 |
| P3-T13 | 代码编辑器 | 提示词编辑、条件表达式 | 6h | 待分配 | P3-T11 |
| P3-T14 | 表单验证 | 实时验证、错误提示 | 4h | 待分配 | P3-T11 |

#### 3.4 编辑器功能
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P3-T15 | 撤销重做 | HistoryManager, 时间旅行 | 6h | 待分配 | P3-T1 |
| P3-T16 | 复制粘贴 | ClipboardManager | 4h | 待分配 | P3-T15 |
| P3-T17 | 快捷键 | 键盘快捷键绑定 | 4h | 待分配 | P3-T16 |
| P3-T18 | 右键菜单 | ContextMenu组件 | 4h | 待分配 | P3-T1 |
| P3-T19 | 导入导出 | JSON/YAML序列化 | 4h | 待分配 | P3-T1 |

#### 3.5 状态管理
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P3-T20 | Zustand Store | FlowState, 画布状态 | 6h | 待分配 | P3-T1 |
| P3-T21 | 选中状态 | 节点/边选中管理 | 2h | 待分配 | P3-T20 |
| P3-T22 | 执行状态 | 运行时状态同步 | 6h | 待分配 | P3-T20 |

**Phase 3 交付物：**
- [ ] 可视化编辑器完整功能
- [ ] 撤销重做、复制粘贴
- [ ] 属性面板动态表单
- [ ] 快捷键支持

---

### Phase 4: 编排引擎 (第12-14周)

#### 4.1 工作流解析
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P4-T1 | WorkflowParser | 解析画布数据为DAG | 6h | 待分配 | P1-T13 |
| P4-T2 | 循环检测 | DFS检测图中环 | 4h | 待分配 | P4-T1 |
| P4-T3 | 连通性验证 | 验证工作流完整性 | 4h | 待分配 | P4-T1 |
| P4-T4 | 依赖解析 | 节点依赖关系计算 | 4h | 待分配 | P4-T1 |

#### 4.2 执行引擎
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P4-T5 | ExecutionScheduler | 拓扑排序调度 | 6h | 待分配 | P4-T4 |
| P4-T6 | NodeExecutor | 节点执行器 | 6h | 待分配 | P4-T5 |
| P4-T7 | 条件分支 | ConditionEvaluator | 6h | 待分配 | P4-T6 |
| P4-T8 | 并行执行 | ParallelExecutor | 6h | 待分配 | P4-T6 |
| P4-T9 | 结果聚合 | ResultAggregator | 4h | 待分配 | P4-T8 |

#### 4.3 检查点与恢复
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P4-T10 | CheckpointManager | 检查点创建和管理 | 6h | 待分配 | P1-T14 |
| P4-T11 | 状态序列化 | MessagePack序列化 | 4h | 待分配 | P4-T10 |
| P4-T12 | 状态恢复 | 从检查点恢复执行 | 6h | 待分配 | P4-T11 |
| P4-T13 | 故障恢复 | 自动重试、错误处理 | 6h | 待分配 | P4-T12 |

**Phase 4 交付物：**
- [ ] 工作流执行引擎
- [ ] 条件分支和并行执行
- [ ] 检查点和故障恢复

---

### Phase 5: 高级功能 (第15-17周)

#### 5.1 子图嵌套
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P5-T1 | SubgraphNode | 子图节点类型 | 6h | 待分配 | P4-T6 |
| P5-T2 | SubgraphExecutor | 子图执行器 | 6h | 待分配 | P5-T1 |
| P5-T3 | 上下文隔离 | 子图上下文隔离 | 4h | 待分配 | P5-T2 |
| P5-T4 | 嵌套限制 | 最大嵌套深度控制 | 2h | 待分配 | P5-T3 |

#### 5.2 人机协作
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P5-T5 | HumanNode | 人工审核节点 | 6h | 待分配 | P3-T7 |
| P5-T6 | 人工介入 | 暂停执行等待输入 | 6h | 待分配 | P5-T5 |
| P5-T7 | 实时流式 | SSE流式状态推送 | 6h | 待分配 | P2-T4 |
| P5-T8 | 视角切换 | 以Agent身份查看 | 6h | 待分配 | P5-T7 |

#### 5.3 执行可视化
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P5-T9 | 执行状态UI | 节点状态实时显示 | 6h | 待分配 | P3-T22 |
| P5-T10 | 执行日志 | 日志面板、过滤搜索 | 6h | 待分配 | P5-T9 |
| P5-T11 | 执行历史 | 历史执行记录 | 4h | 待分配 | P5-T10 |
| P5-T12 | 性能指标 | Token消耗、耗时统计 | 4h | 待分配 | P5-T11 |

**Phase 5 交付物：**
- [ ] 子图嵌套支持
- [ ] 人机协作功能
- [ ] 执行可视化面板
- [ ] 实时流式输出

---

### Phase 6: 部署优化 (第18-19周)

#### 6.1 容器化
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P6-T1 | Dockerfile | 多阶段构建优化 | 4h | 待分配 | 无 |
| P6-T2 | Docker Compose | 开发环境编排 | 4h | 待分配 | P6-T1 |
| P6-T3 | 镜像构建脚本 | CI/CD镜像构建 | 4h | 待分配 | P6-T2 |

#### 6.2 Kubernetes
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P6-T4 | K8s Manifests | Deployment, Service, ConfigMap | 8h | 待分配 | P6-T2 |
| P6-T5 | HPA配置 | 自动扩缩容 | 4h | 待分配 | P6-T4 |
| P6-T6 | Ingress配置 | 路由、SSL终止 | 4h | 待分配 | P6-T4 |
| P6-T7 | 持久化存储 | PVC, StorageClass | 4h | 待分配 | P6-T4 |

#### 6.3 CI/CD
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P6-T8 | GitHub Actions | CI/CD Pipeline | 6h | 待分配 | P6-T3 |
| P6-T9 | 灰度发布 | Canary部署策略 | 4h | 待分配 | P6-T8 |
| P6-T10 | 自动回滚 | 故障自动回滚 | 4h | 待分配 | P6-T9 |

#### 6.4 监控告警
| 任务ID | 任务名称 | 详细描述 | 预估工时 | 负责人 | 依赖 |
|--------|----------|----------|----------|--------|------|
| P6-T11 | Prometheus | 指标采集 | 6h | 待分配 | P6-T4 |
| P6-T12 | Grafana | 监控仪表盘 | 6h | 待分配 | P6-T11 |
| P6-T13 | AlertManager | 告警规则 | 4h | 待分配 | P6-T12 |
| P6-T14 | Loki | 日志收集 | 4h | 待分配 | P6-T11 |

**Phase 6 交付物：**
- [ ] Docker容器化
- [ ] Kubernetes部署
- [ ] CI/CD流水线
- [ ] 监控告警系统

---

## 5. 开发里程碑

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          开发里程碑                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  M1 - 第3周                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ✅ 基础架构完成                                                      │   │
│  │   - 项目脚手架就绪                                                   │   │
│  │   - 数据库Schema就绪                                                 │   │
│  │   - 类型定义完整                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  M2 - 第7周                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ✅ Agent运行时可用                                                   │   │
│  │   - Agent自运行机制                                                  │   │
│  │   - 消息总线系统                                                     │   │
│  │   - MCP工具集成                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  M3 - 第11周                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ✅ 可视化编辑器可用                                                  │   │
│  │   - ReactFlow画布完整                                                │   │
│  │   - 节点系统完整                                                     │   │
│  │   - 撤销重做、复制粘贴                                               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  M4 - 第14周                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ✅ 编排引擎可用                                                      │   │
│  │   - 工作流执行引擎                                                   │   │
│  │   - 检查点和故障恢复                                                 │   │
│  │   - 条件分支和并行执行                                               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  M5 - 第17周                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ✅ 高级功能完成                                                      │   │
│  │   - 子图嵌套                                                         │   │
│  │   - 人机协作                                                         │   │
│  │   - 执行可视化                                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              ↓                                              │
│  M6 - 第19周                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ✅ 生产就绪                                                          │   │
│  │   - 容器化部署                                                       │   │
│  │   - 监控告警                                                         │   │
│  │   - 完整文档                                                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 依赖关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          任务依赖关系图                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Phase 1: 基础架构                                                          │
│  ┌─────┐   ┌─────┐   ┌─────┐                                               │
│  │T1-6 │ → │T7-11│ → │T12  │                                               │
│  │脚手架│   │数据库│   │类型 │                                               │
│  └─────┘   └─────┘   └─────┘                                               │
│                              ↓                                              │
│  Phase 2: Agent运行时 ←──────────────────────────────────────────────┐      │
│  ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐                              │      │
│  │T1-6 │ → │T7-11│ → │T12  │ → │T17  │                              │      │
│  │运行时│   │管理器│   │消息 │   │MCP  │                              │      │
│  └─────┘   └─────┘   └─────┘   └─────┘                              │      │
│                              ↓                                       │      │
│  Phase 3: 可视化编辑器 ←─────────────────────────────────────┐       │      │
│  ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐           │       │      │
│  │T1-5 │ → │T6-10│ → │T11  │ → │T15  │ → │T20  │           │       │      │
│  │画布 │   │节点 │   │属性 │   │编辑 │   │状态 │           │       │      │
│  └─────┘   └─────┘   └─────┘   └─────┘   └─────┘           │       │      │
│                              ↓                             │       │      │
│  Phase 4: 编排引擎 ←──────────────────────────────┐         │       │      │
│  ┌─────┐   ┌─────┐   ┌─────┐                     │         │       │      │
│  │T1-4 │ → │T5-9 │ → │T10  │                     │         │       │      │
│  │解析 │   │执行 │   │检查点│                     │         │       │      │
│  └─────┘   └─────┘   └─────┘                     │         │       │      │
│                              ↓                   │         │       │      │
│  Phase 5: 高级功能 ←────────────────────┐         │         │       │      │
│  ┌─────┐   ┌─────┐   ┌─────┐           │         │         │       │      │
│  │T1-4 │ → │T5-8 │ → │T9-12│           │         │         │       │      │
│  │子图 │   │人机 │   │可视化│           │         │         │       │      │
│  └─────┘   └─────┘   └─────┘           │         │         │       │      │
│                              ↓         │         │         │       │      │
│  Phase 6: 部署优化                     │         │         │       │      │
│  ┌─────┐   ┌─────┐   ┌─────┐   ┌─────┐│         │         │       │      │
│  │T1-3 │ → │T4-7 │ → │T8-10│ → │T11  ││         │         │       │      │
│  │Docker│   │K8s │   │CI/CD│   │监控 ││         │         │       │      │
│  └─────┘   └─────┘   └─────┘   └─────┘│         │         │       │      │
│                                       │         │         │       │      │
│  关键依赖:                             │         │         │       │      │
│  ─────────────────                    │         │         │       │      │
│  P2依赖P1 (类型定义) ←────────────────┘         │         │       │      │
│  P3依赖P1 (类型定义) ←──────────────────────────┘         │       │      │
│  P3依赖P2 (Agent状态) ←───────────────────────────────────┘       │      │
│  P4依赖P1 (类型定义) ←────────────────────────────────────────────┘      │
│  P4依赖P2 (Agent执行) ←──────────────────────────────────────────────────┘
│  P5依赖P3 (画布)                                                      │
│  P5依赖P4 (执行引擎)                                                  │
│  P6无强依赖，可并行                                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 团队分工建议

### 7.1 推荐团队配置

| 角色 | 人数 | 职责 |
|------|------|------|
| 架构师 | 1 | 整体架构、技术决策、代码审查 |
| 后端工程师 | 2-3 | Agent运行时、消息总线、编排引擎 |
| 前端工程师 | 2-3 | 可视化编辑器、ReactFlow、UI组件 |
| DevOps工程师 | 1 | 部署、CI/CD、监控 |
| 产品经理 | 1 | 需求梳理、里程碑管理 |

### 7.2 模块负责人分配

| 模块 | 推荐负责人 | 技能要求 |
|------|-----------|---------|
| 基础架构 | 架构师 | TypeScript, Monorepo |
| Agent运行时 | 后端工程师A | 异步编程, 状态机 |
| 消息总线 | 后端工程师B | Redis, 消息队列 |
| 可视化编辑器 | 前端工程师A | React, ReactFlow |
| 编排引擎 | 后端工程师A | DAG算法, 调度 |
| 部署运维 | DevOps工程师 | K8s, CI/CD |

### 7.3 并行开发策略

**Week 1-3 (Phase 1)**
- 全团队参与基础架构搭建

**Week 4-7 (Phase 2)**
- 后端团队：Agent运行时 + 消息总线
- 前端团队：基础UI组件 + 类型定义

**Week 8-11 (Phase 3)**
- 前端团队：可视化编辑器主力开发
- 后端团队：编排引擎开发

**Week 12-14 (Phase 4)**
- 后端团队：编排引擎完善
- 前端团队：集成API接口

**Week 15-17 (Phase 5)**
- 全团队：高级功能联调

**Week 18-19 (Phase 6)**
- DevOps：部署优化
- 开发团队：Bug修复、文档完善

---

## 附录

### 任务优先级标记

| 标记 | 含义 |
|------|------|
| 🔴 Blocker | 阻塞其他任务，必须优先完成 |
| 🟠 Critical | 关键路径任务 |
| 🟡 Normal | 普通优先级 |
| 🟢 Low | 低优先级，可延后 |

### 关键路径

```
P1-T1 → P1-T7 → P1-T12 → P2-T1 → P2-T7 → P2-T12 → P3-T1 → P3-T6 → P3-T11 
→ P3-T20 → P4-T1 → P4-T5 → P4-T10 → P5-T1 → P5-T5 → P5-T9
```

---

*文档结束*
